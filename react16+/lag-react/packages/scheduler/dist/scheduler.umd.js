(function(r,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("shared/utils")):typeof define=="function"&&define.amd?define(["exports","shared/utils"],o):(r=typeof globalThis<"u"?globalThis:r||self,o(r.scheduler={},r.utils))})(this,function(r,o){"use strict";function C(e){let t;switch(e){case 1:t=-1;break;case 2:t=250;break;case 5:t=1073741823;break;case 4:t=1e4;break;case 3:default:t=5e3;break}return t}function U(e,t){const i=e.length;e.push(t),W(e,t,i)}function c(e){return e.length===0?null:e[0]}function O(e){if(e.length===0)return null;const t=e[0],i=e.pop();return i!==t&&(e[0]=i,A(e,i,0)),t}function W(e,t,i){let n=i;for(;n>0;){const l=n-1>>>1,d=e[l];if(y(d,t)>0)e[l]=t,e[n]=d,n=l;else return}}function A(e,t,i){let n=i;const l=e.length,d=l>>>1;for(;n<d;){const I=(n+1)*2-1,a=e[I],u=I+1,g=e[u];if(y(a,t)<0)u<l&&y(g,a)<0?(e[n]=g,e[u]=t,n=u):(e[n]=a,e[I]=t,n=I);else if(u<l&&y(g,t)<0)e[n]=g,e[u]=t,n=u;else return}}function y(e,t){const i=e.sortIndex-t.sortIndex;return i!==0?i:e.id-t.id}const T=[],f=[];let R=1,s=null,_=3,m=!1,P=!1,L=!1,h,M=!1,E=null,S=-1,H=5;function N(){clearTimeout(R),R=-1}function b(e,t){R=setTimeout(()=>{e(o.getCurrentTime())},t)}function k(e){let t=c(f);for(;t!==null;){if(t.callback===null)O(f);else if(t.startTime<=e)O(f),t.sortIndex=t.expirationTime,U(T,t);else return;t=c(f)}}function Y(e){if(m=!1,k(e),!P)if(c(T)!==null)P=!0,w(v);else{const t=c(f);t!==null&&b(Y,t.startTime-e)}}function w(e){E=e,M||(M=!0,h())}const j=()=>{if(E!==null){const e=o.getCurrentTime();S=e;const t=!0;let i=!0;try{i=E(t,e)}finally{i?h():(M=!1,E=null)}}else M=!1},B=new MessageChannel,q=B.port2;B.port1.onmessage=j,h=()=>{q.postMessage(null)};function v(e,t){P=!1,m&&(m=!1,N()),L=!0;let i=_;try{return G(e,t)}finally{s=null,_=i,L=!1}}function G(e,t){let i=t;for(k(i),s=c(T);s!==null;){const n=K();if(s.expirationTime>i&&(!e||n))break;const l=s.callback;if(_=s.priorityLevel,o.isFn(l)){s.callback=null;const d=s.expirationTime<=i,I=l(d);if(i=o.getCurrentTime(),o.isFn(I))return s.callback=I,k(i),!0;s===c(T)&&O(T),k(i)}else O(T);s=c(T)}if(s!==null)return!0;{const n=c(f);return n!==null&&b(Y,n.startTime-i),!1}}function K(){return!(o.getCurrentTime()-S<H)}function x(e,t,i){const n=o.getCurrentTime();let l;if(o.isObject(i)&&i!==null){let u=i==null?void 0:i.delay;typeof u=="number"&&u>0?l=n+u:l=n}else l=n;const d=C(e),I=l+d,a={id:R++,callback:t,priorityLevel:e,startTime:l,expirationTime:I,sortIndex:-1};l>n?(a.sortIndex=l,U(f,a),c(T)===null&&a===c(f)&&(m?N():m=!0,b(Y,l-n))):(a.sortIndex=I,U(T,a),!P&&!L&&(P=!0,w(v)))}function F(e){e.callback=null}function D(){return _}function Q(){}const z=Object.freeze(Object.defineProperty({__proto__:null,scheduleCallback:x,cancelCallback:F,getCurrentPriorityLevel:D,requestPaint:Q},Symbol.toStringTag,{value:"Module"}));r.IDLE_PRIORITY_TIMEOUT=1073741823,r.IMMEDIATE_PRIORITY_TIMEOUT=-1,r.IdlePriority=5,r.IdleSchedulerPriority=5,r.ImmediatePriority=1,r.ImmediateSchedulerPriority=1,r.LOW_PRIORITY_TIMEOUT=1e4,r.LowPriority=4,r.LowSchedulerPriority=4,r.NORMAL_PRIORITY_TIMEOUT=5e3,r.NoPriority=0,r.NormalPriority=3,r.NormalSchedulerPriority=3,r.Scheduler=z,r.USER_BLOCKING_PRIORITY_TIMEOUT=250,r.UserBlockingPriority=2,r.UserBlockingSchedulerPriority=2,r.getCurrentSchedulerPriorityLevel=D,r.getTimeoutByPriorityLevel=C,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=scheduler.umd.js.map
